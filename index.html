<!DOCTYPE html>
<html>
  <head>
    <title>Consent</title>
    <script src="jsPsych-6.0.1/jspsych.js"></script>
    <script src="jsPsych-6.0.1/plugins/jspsych-external-html.js"></script>
    <script src='js/jquery.min.js'></script>
    <script src='js/jsPsych-6.0.1/poldrack_plugins/poldrack_utils.js'></script>
    <link href="jsPsych-6.0.1/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body></body>
  <script>
    // check if participant has given consent to participate.
    var check_consent = function(elem) {
      if ($('#consent_checkbox').is(':checked')) {
        return true;
      }
      else {
        alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
        return false;
      }
      return false;
    };


    var timeline = [];

    // consent block
    var trial = {
      type:'external-html',
      url: "study_info.html",
      cont_btn: "start",
      check_fn: check_consent
    };
    timeline.push(trial);

    /* start the experiment */
    jsPsych.init({
      timeline: timeline
    });
    $( document ).ready(function() {
      jsPsych.init({
               timeline: timeline,
               on_trial_finish: function(data) {
                 addID('consent-task')
               },
               on_finish: function(data) {
                   // serialize the data
                   var promise = new Promise(function(resolve, reject) {
                       var data = jsPsych.data.get().json();
                       resolve(data);
                   })
                   promise.then(function(data) {
                       $.ajax({
                           type: "POST",
                           url: '/save',
                           data: { "data": data },
                           success: function(){ document.location = "/next" },
                           dataType: "application/json",
                           error: function(err) {
                               if (err.status == 200) {          // endpoint not running
                                  document.location = "/next"
                               } else {                          // local save
                                   jsPsych.data.get().localSave('json','consent-task_results.json');
                              }
                           }
                       });
                   })
               }
        });
    });
  </script>
  </html>